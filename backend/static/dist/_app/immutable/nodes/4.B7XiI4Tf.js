import{r as ct}from"../chunks/hp4PFHFv.js";import{a as mt,b as ft,p as pt,e as gt,i as vt}from"../chunks/Cz_w3iUV.js";import{f as ae,a as o,c as d,i as Ce,t as V,s as W}from"../chunks/DRF5TCtt.js";import{p as _t,m as l,h as w,g as e,u as Fe,q as $t,v as ht,a as Tt,c as X,s as c,w as r,r as Z,f as n,n as ee,t as te}from"../chunks/BjAeDMBy.js";import{c as s}from"../chunks/g5lWU4bW.js";import{c as He,t as Ke,f as Ye}from"../chunks/CDT9LSXp.js";import{g as Pt}from"../chunks/BOe3pJkQ.js";import{b as ge,T as ve,a as j,c as bt,d as xt}from"../chunks/y6C-zUiM.js";import"../chunks/2wOyHH5q.js";import{L as St}from"../chunks/2O2paTqt.js";import{T as yt,a as re}from"../chunks/PdIRTCrQ.js";import{I as Dt}from"../chunks/uF175uzZ.js";import{P as wt}from"../chunks/BUOTwRzw.js";import{p as Je,g as Qe,d as _e,c as $e,T as Ct,u as Ft}from"../chunks/DYapue6Z.js";import{c as It}from"../chunks/zDxND3qM.js";import{r as Rt}from"../chunks/UIOQSdMs.js";import{P as zt}from"../chunks/DpxRarxq.js";import{g as Lt,h as Ut,s as jt}from"../chunks/X-i49s3k.js";const kt=()=>{if(!mt.isAuthenticated)throw ct(302,"/login")},nr=Object.freeze(Object.defineProperty({__proto__:null,load:kt},Symbol.toStringTag,{value:"Module"}));var Et=ae('<div class="flex justify-center items-center h-full"><!></div>'),Ot=ae("<!> <!> <!> <!> <!>",1),qt=ae("<!> <!> <!> <!> <!>",1),At=ae("<!> <!>",1),Mt=ae('<div class="space-y-4"><div class="flex flex-col gap-4 sm:flex-row sm:justify-between"><!> <div class="flex flex-col"><!></div></div> <div class="rounded-md border overflow-hidden"><!></div> <!></div>');function lr(Ve,We){_t(We,!0);const k=Fe(Pt);let he=l(w([])),oe=l(!0),se=l(""),C=l(1),Te=l(100),Ie=l(0),Pe=l(0);const Re=Je(e(k)),ne=Qe(Re,e(k));let E=l(w(Re.preset)),F=l(w(_e(ne.from))),I=l(w(_e(ne.to))),N=l(w($e(ne.from))),G=l(w($e(ne.to)));function Xe(t=!0){Ft(e(E)?{preset:e(E)}:{from:je(),to:ke()},{pushToHistory:t})}function ze(){const t=Je(e(k)),a=Qe(t,e(k));r(E,t.preset,!0),r(F,_e(a.from),!0),r(N,$e(a.from),!0),r(I,_e(a.to),!0),r(G,$e(a.to),!0),r(C,1),O(!1)}const Le="endpoints",Ue=Lt(Le,{field:"impact",direction:"desc"});let R=l(w(Ue.field)),z=l(w(Ue.direction));function je(){const[t,a]=(e(N)||"00:00").split(":").map(Number),i=He({year:e(F).year,month:e(F).month,day:e(F).day,hour:t,minute:a},e(k));return Ke(i)}function ke(){const[t,a]=(e(G)||"23:59").split(":").map(Number),i=He({year:e(I).year,month:e(I).month,day:e(I).day,hour:t,minute:a},e(k));return Ke(i)}function Ze(t,a,i){r(F,t.date,!0),r(N,t.time,!0),r(I,a.date,!0),r(G,a.time,!0),r(E,i,!0),r(C,1),O(!0)}function et(t){return t>=1e6?`${(t/1e6).toFixed(1)}m`:t>=1e3?`${(t/1e3).toFixed(1)}k`:t.toLocaleString()}function tt(t,a,i){const qe=(i-a)/1e6,q=t*qe;return q>100?"critical":q>10?"high":q>1?"medium":null}async function O(t=!0){r(oe,!0),r(se,""),Xe(t);try{const a={fromDate:je(),toDate:ke(),orderBy:e(R),sortDirection:e(z),pagination:{page:e(C),pageSize:e(Te)}},i=await ft.post("/endpoints/grouped",a,{projectId:pt.currentProjectId??void 0});r(he,i.data||[],!0),r(Ie,i.pagination.total,!0),r(Pe,i.pagination.totalPages,!0)}catch(a){console.error(a),r(se,a.message||"Failed to load data",!0)}finally{r(oe,!1)}}function rt(t){t>=1&&t<=e(Pe)&&(r(C,t,!0),O(!1))}function at(t){r(Te,t,!0),r(C,1),O(!1)}function le(t){const a=Ut(t,e(R),e(z));r(R,a.field,!0),r(z,a.direction,!0),jt(Le,a),r(C,1),O(!1)}$t(()=>{window.addEventListener("popstate",ze),O(!1)}),ht(()=>{typeof window<"u"&&window.removeEventListener("popstate",ze)});var be=Mt(),xe=X(be),Ee=X(xe);zt(Ee,{title:"Endpoints"});var Oe=c(Ee,2),ot=X(Oe);Ct(ot,{onApply:Ze,get fromDate(){return e(F)},set fromDate(t){r(F,t,!0)},get toDate(){return e(I)},set toDate(t){r(I,t,!0)},get fromTime(){return e(N)},set fromTime(t){r(N,t,!0)},get toTime(){return e(G)},set toTime(t){r(G,t,!0)},get preset(){return e(E)},set preset(t){r(E,t,!0)}}),Z(Oe),Z(xe);var Se=c(xe,2),st=X(Se);s(st,()=>bt,(t,a)=>{a(t,{children:(i,qe)=>{var q=d(),lt=n(q);{var it=A=>{var H=d(),ye=n(H);s(ye,()=>ge,(De,we)=>{we(De,{children:(b,M)=>{var B=d(),K=n(B);s(K,()=>ve,(Y,f)=>{f(Y,{children:(x,S)=>{var y=d(),g=n(y);s(g,()=>j,(v,D)=>{D(v,{colspan:5,class:"h-48",children:(ie,_)=>{var $=Et(),L=X($);St(L,{size:"xlg"}),Z($),o(ie,$)},$$slots:{default:!0}})}),o(x,y)},$$slots:{default:!0}})}),o(b,B)},$$slots:{default:!0}})}),o(A,H)},dt=A=>{var H=d(),ye=n(H);{var De=b=>{var M=d(),B=n(M);s(B,()=>ge,(K,Y)=>{Y(K,{children:(f,x)=>{var S=d(),y=n(S);s(y,()=>ve,(g,v)=>{v(g,{children:(D,ie)=>{var _=d(),$=n(_);s($,()=>j,(L,u)=>{u(L,{colspan:5,class:"h-24 text-center text-red-500",children:(J,de)=>{ee();var U=V();te(()=>W(U,e(se))),o(J,U)},$$slots:{default:!0}})}),o(D,_)},$$slots:{default:!0}})}),o(f,S)},$$slots:{default:!0}})}),o(b,M)},we=b=>{var M=d(),B=n(M);{var K=f=>{var x=d(),S=n(x);s(S,()=>ge,(y,g)=>{g(y,{children:(v,D)=>{yt(v,{colspan:5,message:"No endpoint data received yet"})},$$slots:{default:!0}})}),o(f,x)},Y=f=>{var x=At(),S=n(x);s(S,()=>xt,(g,v)=>{v(g,{children:(D,ie)=>{var _=d(),$=n(_);s($,()=>ve,(L,u)=>{u(L,{children:(J,de)=>{var U=Ot(),ue=n(U);re(ue,{label:"Endpoint",tooltip:"The API route or page being accessed",class:"max-w-[50%]"});var ce=c(ue,2);re(ce,{label:"Calls",tooltip:"Total number of requests",sortField:"count",get currentSortField(){return e(R)},get sortDirection(){return e(z)},onSort:p=>le(p),class:"w-[100px]"});var me=c(ce,2);re(me,{label:"Typical",tooltip:"Median response time (P50)",sortField:"p50_duration",get currentSortField(){return e(R)},get sortDirection(){return e(z)},onSort:p=>le(p),class:"w-[100px]"});var fe=c(me,2);re(fe,{label:"Slow",tooltip:"95th percentile - slowest 5% of requests",sortField:"p95_duration",get currentSortField(){return e(R)},get sortDirection(){return e(z)},onSort:p=>le(p),class:"w-[100px]"});var Ae=c(fe,2);re(Ae,{label:"Impact",tooltip:"Priority based on traffic Ã— response time variance",sortField:"impact",get currentSortField(){return e(R)},get sortDirection(){return e(z)},onSort:p=>le(p),align:"right",class:"w-[120px]"}),o(J,U)},$$slots:{default:!0}})}),o(D,_)},$$slots:{default:!0}})});var y=c(S,2);s(y,()=>ge,(g,v)=>{v(g,{children:(D,ie)=>{var _=d(),$=n(_);gt($,17,()=>e(he),vt,(L,u)=>{const J=Fe(()=>tt(e(u).count,e(u).p50Duration,e(u).p95Duration));var de=d(),U=n(de);{let ue=Fe(()=>It(Rt(`/endpoints/${encodeURIComponent(e(u).endpoint)}`),"preset","from","to"));s(U,()=>ve,(ce,me)=>{me(ce,{class:"cursor-pointer hover:bg-muted/50",get onclick(){return e(ue)},children:(fe,Ae)=>{var p=qt(),Me=n(p);s(Me,()=>j,(h,T)=>{T(h,{class:"font-mono text-sm max-w-[50%] break-all whitespace-normal",children:(P,pe)=>{ee();var m=V();te(()=>W(m,e(u).endpoint)),o(P,m)},$$slots:{default:!0}})});var Be=c(Me,2);s(Be,()=>j,(h,T)=>{T(h,{class:"tabular-nums",children:(P,pe)=>{ee();var m=V();te(Q=>W(m,Q),[()=>et(e(u).count)]),o(P,m)},$$slots:{default:!0}})});var Ne=c(Be,2);s(Ne,()=>j,(h,T)=>{T(h,{class:"font-mono text-sm tabular-nums",children:(P,pe)=>{ee();var m=V();te(Q=>W(m,Q),[()=>Ye(e(u).p50Duration)]),o(P,m)},$$slots:{default:!0}})});var Ge=c(Ne,2);s(Ge,()=>j,(h,T)=>{T(h,{class:"font-mono text-sm tabular-nums",children:(P,pe)=>{ee();var m=V();te(Q=>W(m,Q),[()=>Ye(e(u).p95Duration)]),o(P,m)},$$slots:{default:!0}})});var ut=c(Ge,2);s(ut,()=>j,(h,T)=>{T(h,{class:"text-right",children:(P,pe)=>{Dt(P,{get level(){return e(J)}})},$$slots:{default:!0}})}),o(fe,p)},$$slots:{default:!0}})})}o(L,de)}),o(D,_)},$$slots:{default:!0}})}),o(f,x)};Ce(B,f=>{e(he).length===0?f(K):f(Y,!1)},!0)}o(b,M)};Ce(ye,b=>{e(se)?b(De):b(we,!1)},!0)}o(A,H)};Ce(lt,A=>{e(oe)?A(it):A(dt,!1)})}o(i,q)},$$slots:{default:!0}})}),Z(Se);var nt=c(Se,2);wt(nt,{get currentPage(){return e(C)},get totalPages(){return e(Pe)},get pageSize(){return e(Te)},get totalItems(){return e(Ie)},onPageChange:rt,onPageSizeChange:at,get loading(){return e(oe)},itemLabel:"endpoint"}),Z(be),o(Ve,be),Tt()}export{lr as component,nr as universal};
