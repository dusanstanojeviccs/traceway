import{f as O,i as I,a as u,c as B}from"../chunks/DRF5TCtt.js";import{p as de,m as i,h as le,q as ue,f,a as pe,c as G,w as a,g as e,s as T,u as d,r as U}from"../chunks/BjAeDMBy.js";import{b,p as H}from"../chunks/Cz_w3iUV.js";import{L as fe}from"../chunks/2O2paTqt.js";import{E as V}from"../chunks/CEa0NWkH.js";import{g as ge}from"../chunks/BOe3pJkQ.js";import{b as ve}from"../chunks/CDT9LSXp.js";import{S as me,a as he,E as xe}from"../chunks/1mOUjuSW.js";import{P as _e}from"../chunks/DpxRarxq.js";import{c as L}from"../chunks/zDxND3qM.js";import{r as E}from"../chunks/UIOQSdMs.js";import{A as ke}from"../chunks/DPmphkir.js";import{g as ye}from"../chunks/C3Sf7PJj.js";import{t as Ie}from"../chunks/DJXxIydW.js";const Te=!1;function be({params:g}){return{exceptionHash:g.exceptionHash,exceptionId:g.exceptionId}}const We=Object.freeze(Object.defineProperty({__proto__:null,load:be,prerender:Te},Symbol.toStringTag,{value:"Module"}));var He=O('<div class="flex items-center justify-center py-20"><!></div>'),Ee=O("<!> <!> <!>",1),je=O('<div class="space-y-6"><!> <!></div> <!>',1);function qe(g,c){de(c,!0);const J=d(ge);let p=i(null),r=i(null),C=i(le([])),j=i(!0),v=i(""),m=i(!1),w=i(0),A=i(null),h=i(!1),x=i(!1);const K=d(()=>e(r)?.isMessage??!1),Q=d(()=>e(p)?.stackTrace.split(`
`)[0]||"Exception"),X=d(()=>e(w)>10),Y=d(()=>e(r)?`Event from ${ve(e(r).recordedAt,{timezone:e(J)})}`:"Loading...");async function S(){a(j,!0),a(v,""),a(m,!1),a(A,null);try{const t=await b.post(`/exception-stack-traces/by-id/${c.data.exceptionId}`,{},{projectId:H.currentProjectId??void 0});if(a(r,t.exception,!0),!e(r)){a(m,!0);return}const s=await b.post(`/exception-stack-traces/${c.data.exceptionHash}`,{pagination:{page:1,pageSize:10}},{projectId:H.currentProjectId??void 0});if(a(p,s.group,!0),a(C,s.occurrences||[],!0),a(w,s.pagination.total,!0),e(r).transactionId)try{const n=e(r).transactionType==="task";console.log("DEBUG linked transaction:",{transactionId:e(r).transactionId,transactionType:e(r).transactionType,isTask:n});const M=n?"/tasks":"/endpoints",_=await b.post(`${M}/${e(r).transactionId}`,{},{projectId:H.currentProjectId??void 0}),o=n?_.task:_.endpoint;o&&a(A,{id:o.id,endpoint:n?o.taskName:o.endpoint,duration:o.duration,statusCode:o.statusCode||0,recordedAt:o.recordedAt,transactionType:n?"task":"endpoint"},!0)}catch(n){console.error("Failed to load linked transaction:",{error:n,transactionId:e(r).transactionId,transactionType:e(r).transactionType})}}catch(t){console.error(t),t.status===404?a(m,!0):a(v,t.message||"Failed to load exception details",!0)}finally{a(j,!1)}}async function Z(){a(x,!0);try{await b.post("/exception-stack-traces/archive",{hashes:[c.data.exceptionHash]},{projectId:H.currentProjectId??void 0}),Ie.success("Successfully archived the Issue"),ye(E("/issues"))}catch(t){throw console.error("Archive failed:",t),t}finally{a(x,!1)}}ue(()=>{S()});var R=je(),D=f(R),F=G(D);{let t=d(()=>L(E("/issues/[exceptionHash]",{exceptionHash:c.data.exceptionHash})));_e(F,{get title(){return e(Q)},get subtitle(){return e(Y)},get onBack(){return e(t)}})}var $=T(F,2);{var ee=t=>{var s=He(),n=G(s);fe(n,{size:"xlg"}),U(s),u(t,s)},te=t=>{var s=B(),n=f(s);{var M=o=>{{let k=d(()=>L(E("/issues/[exceptionHash]",{exceptionHash:c.data.exceptionHash}),"presets","from","to"));V(o,{status:404,title:"Event Not Found",description:"The specific event you're looking for doesn't exist or may have been removed.",get onBack(){return e(k)},backLabel:"Back to Exception",onRetry:()=>S()})}},_=o=>{var k=B(),re=f(k);{var oe=l=>{{let y=d(()=>L(E("/issues/[exceptionHash]",{exceptionHash:c.data.exceptionHash}),"presets","from","to"));V(l,{status:400,title:"Something Went Wrong",get description(){return e(v)},get onBack(){return e(y)},backLabel:"Back to Exception",onRetry:()=>S()})}},ne=l=>{var y=B(),se=f(y);{var ie=P=>{var N=Ee(),W=f(N);me(W,{get stackTrace(){return e(p).stackTrace},get isMessage(){return e(K)},get showArchiveDialog(){return e(h)},set showArchiveDialog(z){a(h,z,!0)},get archiving(){return e(x)},set archiving(z){a(x,z,!0)}});var q=T(W,2);he(q,{get occurrence(){return e(r)},get linkedTransaction(){return e(A)},title:"Event",description:"Details for this specific occurrence"});var ce=T(q,2);xe(ce,{get occurrences(){return e(C)},get exceptionHash(){return c.data.exceptionHash},get total(){return e(w)},get hasMore(){return e(X)},showViewAll:!0,get currentExceptionId(){return c.data.exceptionId}}),u(P,N)};I(se,P=>{e(p)&&e(r)&&P(ie)},!0)}u(l,y)};I(re,l=>{e(v)?l(oe):l(ne,!1)},!0)}u(o,k)};I(n,o=>{e(m)?o(M):o(_,!1)},!0)}u(t,s)};I($,t=>{e(j)&&!e(p)?t(ee):t(te,!1)})}U(D);var ae=T(D,2);ke(ae,{get open(){return e(h)},onOpenChange:t=>a(h,t,!0),count:1,onConfirm:Z}),u(g,R),pe()}export{qe as component,We as universal};
