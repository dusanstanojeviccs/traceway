import{r as pe}from"../chunks/hp4PFHFv.js";import{a as de,b as D,p as L}from"../chunks/Cz_w3iUV.js";import{f as N,i as g,a as f,c as P}from"../chunks/DRF5TCtt.js";import{p as fe,m as n,h as ge,q as ve,f as v,a as me,c as B,w as r,g as e,s as b,u as l,r as R}from"../chunks/BjAeDMBy.js";import{p as G}from"../chunks/BD7i_QTQ.js";import{g as he}from"../chunks/C3Sf7PJj.js";import"../chunks/2wOyHH5q.js";import{L as _e}from"../chunks/2O2paTqt.js";import{E as J}from"../chunks/CEa0NWkH.js";import{S as ke,E as xe,a as ye}from"../chunks/1mOUjuSW.js";import{P as be}from"../chunks/DpxRarxq.js";import{A as we}from"../chunks/DPmphkir.js";import{c as z}from"../chunks/zDxND3qM.js";import{r as F}from"../chunks/UIOQSdMs.js";import{t as Se}from"../chunks/DJXxIydW.js";const Ie=!1,je=({params:w})=>{if(!de.isAuthenticated)throw pe(302,"/login");return{exceptionHash:w.exceptionHash}},Ve=Object.freeze(Object.defineProperty({__proto__:null,load:je,prerender:Ie},Symbol.toStringTag,{value:"Module"}));var Te=N('<div class="flex items-center justify-center py-20"><!></div>'),Ae=N("<!> <!> <!>",1),Ee=N('<div class="space-y-6"><div class="flex items-start justify-between gap-4"><!></div> <!></div> <!>',1);function Ge(w,K){fe(K,!0);let i=n(null),m=n(ge([])),S=n(!0),h=n(""),I=n(!1),j=n(0),T=n(null),_=n(!1),k=n(!1);const x=l(()=>G.params.exceptionHash??""),A=l(()=>e(m)[0]),Q=l(()=>e(A)?.isMessage??!1),U=l(()=>e(j)>10),X=l(()=>e(i)?.stackTrace.split(`
`)[0]||"Exception");async function E(){r(S,!0),r(h,""),r(I,!1),r(T,null);try{const t=G.params.exceptionHash,s=await D.post(`/exception-stack-traces/${t}`,{pagination:{page:1,pageSize:10}},{projectId:L.currentProjectId??void 0});r(i,s.group,!0),r(m,s.occurrences||[],!0),r(j,s.pagination.total,!0);const u=e(m)[0];if(u?.transactionId)try{const c=u.transactionType==="task",M=c?"/tasks":"/endpoints",o=await D.post(`${M}/${u.transactionId}`,{},{projectId:L.currentProjectId??void 0}),a=c?o.task:o.transaction;a&&r(T,{id:a.id,endpoint:c?a.taskName:a.endpoint,duration:a.duration,statusCode:a.statusCode||0,recordedAt:a.recordedAt,transactionType:c?"task":"endpoint"},!0)}catch(c){console.warn("Could not load linked transaction:",c)}}catch(t){console.error(t),t.status===404?r(I,!0):r(h,t.message||"Failed to load exception details",!0)}finally{r(S,!1)}}async function Y(){r(k,!0);try{await D.post("/exception-stack-traces/archive",{hashes:[e(x)]},{projectId:L.currentProjectId??void 0}),Se.success("Successfully archived the Issue"),he("/issues")}catch(t){throw console.error("Archive failed:",t),t}finally{r(k,!1)}}ve(()=>{E()});var W=Ee(),H=v(W),C=B(H),Z=B(C);{let t=l(()=>z(F("/issues")));be(Z,{get title(){return e(X)},get subtitle(){return`Exception Hash: ${e(x)??""}`},get onBack(){return e(t)}})}R(C);var ee=b(C,2);{var te=t=>{var s=Te(),u=B(s);_e(u,{size:"xlg"}),R(s),f(t,s)},re=t=>{var s=P(),u=v(s);{var c=o=>{{let a=l(()=>z(F("/issues"),"presets","from","to"));J(o,{status:404,title:"Exception Not Found",description:"The exception you're looking for doesn't exist or may have been removed. It's possible the data has expired or the link is incorrect.",get onBack(){return e(a)},backLabel:"Back to Issues",onRetry:()=>E(),get identifier(){return e(x)}})}},M=o=>{var a=P(),se=v(a);{var oe=d=>{{let y=l(()=>z(F("/issues"),"presets","from","to"));J(d,{status:400,title:"Something Went Wrong",get description(){return e(h)},get onBack(){return e(y)},backLabel:"Back to Issues",onRetry:()=>E()})}},ne=d=>{var y=P(),ie=v(y);{var ce=O=>{var $=Ae(),q=v($);ke(q,{get stackTrace(){return e(i).stackTrace},get isMessage(){return e(Q)},get firstSeen(){return e(i).firstSeen},get lastSeen(){return e(i).lastSeen},get totalCount(){return e(i).count},get showArchiveDialog(){return e(_)},set showArchiveDialog(p){r(_,p,!0)},get archiving(){return e(k)},set archiving(p){r(k,p,!0)}});var V=b(q,2);{var le=p=>{ye(p,{get occurrence(){return e(A)},get linkedTransaction(){return e(T)},title:"Last Event",description:"Details from the most recent occurrence of this exception"})};g(V,p=>{e(A)&&p(le)})}var ue=b(V,2);xe(ue,{get occurrences(){return e(m)},get exceptionHash(){return e(x)},get total(){return e(j)},get hasMore(){return e(U)},showViewAll:!0}),f(O,$)};g(ie,O=>{e(i)&&O(ce)},!0)}f(d,y)};g(se,d=>{e(h)?d(oe):d(ne,!1)},!0)}f(o,a)};g(u,o=>{e(I)?o(c):o(M,!1)},!0)}f(t,s)};g(ee,t=>{e(S)&&!e(i)?t(te):t(re,!1)})}R(H);var ae=b(H,2);we(ae,{get open(){return e(_)},onOpenChange:t=>r(_,t,!0),count:1,onConfirm:Y}),f(w,W),me()}export{Ge as component,Ve as universal};
