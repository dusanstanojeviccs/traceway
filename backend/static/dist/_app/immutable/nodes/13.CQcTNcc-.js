import{r as lt}from"../chunks/hp4PFHFv.js";import{a as it,b as dt,p as ut,e as mt,i as ct}from"../chunks/Cz_w3iUV.js";import{f as te,a,c as i,i as De,t as Q,s as V}from"../chunks/DRF5TCtt.js";import{p as ft,m as l,h as S,g as e,u as Be,q as pt,v as vt,a as gt,c as W,w as r,s as c,r as X,f as s,n as Z,t as ee}from"../chunks/BjAeDMBy.js";import{c as n}from"../chunks/g5lWU4bW.js";import{c as Me,t as qe,f as Ge}from"../chunks/CDT9LSXp.js";import{g as _t}from"../chunks/BOe3pJkQ.js";import{b as de,T as ue,a as M,c as $t,d as ht}from"../chunks/y6C-zUiM.js";import{L as Tt}from"../chunks/2O2paTqt.js";import{T as Pt,a as me}from"../chunks/PdIRTCrQ.js";import{P as bt}from"../chunks/BUOTwRzw.js";import{p as He,g as Ke,d as ce,c as fe,T as xt,u as St}from"../chunks/DYapue6Z.js";import{c as yt}from"../chunks/zDxND3qM.js";import{r as Dt}from"../chunks/UIOQSdMs.js";import{P as wt}from"../chunks/DpxRarxq.js";import{g as kt,h as Ct,s as Ft}from"../chunks/X-i49s3k.js";const Rt=()=>{if(!it.isAuthenticated)throw lt(302,"/login")},er=Object.freeze(Object.defineProperty({__proto__:null,load:Rt},Symbol.toStringTag,{value:"Module"}));var zt=te('<div class="flex justify-center items-center h-full"><!></div>'),jt=te("<!> <!> <!> <!>",1),Ut=te("<!> <!> <!> <!>",1),Lt=te("<!> <!>",1),It=te('<div class="space-y-4"><div class="flex flex-col gap-4 sm:flex-row sm:justify-between"><!> <div class="flex flex-col"><!></div></div> <div class="rounded-md border overflow-hidden"><!></div> <!></div>');function tr(Ye,Je){ft(Je,!0);const j=Be(_t);let pe=l(S([])),re=l(!0),ae=l(""),y=l(1),ve=l(100),we=l(0),ge=l(0);const ke=He(e(j)),oe=Ke(ke,e(j));let U=l(S(ke.preset)),D=l(S(ce(oe.from))),w=l(S(ce(oe.to))),q=l(S(fe(oe.from))),G=l(S(fe(oe.to)));function Qe(t=!0){St(e(U)?{preset:e(U)}:{from:ze(),to:je()},{pushToHistory:t})}function Ce(){const t=He(e(j)),o=Ke(t,e(j));r(U,t.preset,!0),r(D,ce(o.from),!0),r(q,fe(o.from),!0),r(w,ce(o.to),!0),r(G,fe(o.to),!0),r(y,1),N(!1)}const Fe="tasks",Re=kt(Fe,{field:"count",direction:"desc"});let L=l(S(Re.field)),I=l(S(Re.direction));function ze(){const[t,o]=(e(q)||"00:00").split(":").map(Number),d=Me({year:e(D).year,month:e(D).month,day:e(D).day,hour:t,minute:o},e(j));return qe(d)}function je(){const[t,o]=(e(G)||"23:59").split(":").map(Number),d=Me({year:e(w).year,month:e(w).month,day:e(w).day,hour:t,minute:o},e(j));return qe(d)}function Ve(t,o,d){r(D,t.date,!0),r(q,t.time,!0),r(w,o.date,!0),r(G,o.time,!0),r(U,d,!0),r(y,1),N(!0)}function We(t){return t>=1e6?`${(t/1e6).toFixed(1)}m`:t>=1e3?`${(t/1e3).toFixed(1)}k`:t.toLocaleString()}async function N(t=!0){r(re,!0),r(ae,""),Qe(t);try{const o={fromDate:ze(),toDate:je(),orderBy:e(L),sortDirection:e(I),pagination:{page:e(y),pageSize:e(ve)}},d=await dt.post("/tasks/grouped",o,{projectId:ut.currentProjectId??void 0});r(pe,d.data||[],!0),r(we,d.pagination.total,!0),r(ge,d.pagination.totalPages,!0)}catch(o){console.error(o),r(ae,o.message||"Failed to load data",!0)}finally{r(re,!1)}}function Xe(t){t>=1&&t<=e(ge)&&(r(y,t,!0),N(!1))}function Ze(t){r(ve,t,!0),r(y,1),N(!1)}function _e(t){const o=Ct(t,e(L),e(I));r(L,o.field,!0),r(I,o.direction,!0),Ft(Fe,o),r(y,1),N(!1)}pt(()=>{window.addEventListener("popstate",Ce),N(!1)}),vt(()=>{typeof window<"u"&&window.removeEventListener("popstate",Ce)});var $e=It(),he=W($e),Ue=W(he);wt(Ue,{title:"Tasks"});var Le=c(Ue,2),et=W(Le);xt(et,{onApply:Ve,get fromDate(){return e(D)},set fromDate(t){r(D,t,!0)},get toDate(){return e(w)},set toDate(t){r(w,t,!0)},get fromTime(){return e(q)},set fromTime(t){r(q,t,!0)},get toTime(){return e(G)},set toTime(t){r(G,t,!0)},get preset(){return e(U)},set preset(t){r(U,t,!0)}}),X(Le),X(he);var Te=c(he,2),tt=W(Te);n(tt,()=>$t,(t,o)=>{o(t,{children:(d,Nt)=>{var Ie=i(),at=s(Ie);{var ot=O=>{var H=i(),Pe=s(H);n(Pe,()=>de,(be,xe)=>{xe(be,{children:($,E)=>{var A=i(),K=s(A);n(K,()=>ue,(Y,m)=>{m(Y,{children:(h,T)=>{var P=i(),f=s(P);n(f,()=>M,(p,b)=>{b(p,{colspan:4,class:"h-48",children:(se,v)=>{var g=zt(),k=W(g);Tt(k,{size:"xlg"}),X(g),a(se,g)},$$slots:{default:!0}})}),a(h,P)},$$slots:{default:!0}})}),a($,A)},$$slots:{default:!0}})}),a(O,H)},st=O=>{var H=i(),Pe=s(H);{var be=$=>{var E=i(),A=s(E);n(A,()=>de,(K,Y)=>{Y(K,{children:(m,h)=>{var T=i(),P=s(T);n(P,()=>ue,(f,p)=>{p(f,{children:(b,se)=>{var v=i(),g=s(v);n(g,()=>M,(k,_)=>{_(k,{colspan:4,class:"h-24 text-center text-red-500",children:(B,Se)=>{Z();var C=Q();ee(()=>V(C,e(ae))),a(B,C)},$$slots:{default:!0}})}),a(b,v)},$$slots:{default:!0}})}),a(m,T)},$$slots:{default:!0}})}),a($,E)},xe=$=>{var E=i(),A=s(E);{var K=m=>{var h=i(),T=s(h);n(T,()=>de,(P,f)=>{f(P,{children:(p,b)=>{Pt(p,{colspan:4,message:"No task data received yet"})},$$slots:{default:!0}})}),a(m,h)},Y=m=>{var h=Lt(),T=s(h);n(T,()=>ht,(f,p)=>{p(f,{children:(b,se)=>{var v=i(),g=s(v);n(g,()=>ue,(k,_)=>{_(k,{children:(B,Se)=>{var C=jt(),ne=s(C);me(ne,{label:"Task",tooltip:"The background job or task name"});var le=c(ne,2);me(le,{label:"Runs",tooltip:"Total number of task executions",sortField:"count",get currentSortField(){return e(L)},get sortDirection(){return e(I)},onSort:x=>_e(x),class:"w-[100px]"});var ie=c(le,2);me(ie,{label:"Typical",tooltip:"Median duration (P50)",sortField:"p50_duration",get currentSortField(){return e(L)},get sortDirection(){return e(I)},onSort:x=>_e(x),class:"w-[100px]"});var Ne=c(ie,2);me(Ne,{label:"Slow",tooltip:"95th percentile - slowest 5% of executions",sortField:"p95_duration",get currentSortField(){return e(L)},get sortDirection(){return e(I)},onSort:x=>_e(x),class:"w-[100px]"}),a(B,C)},$$slots:{default:!0}})}),a(b,v)},$$slots:{default:!0}})});var P=c(T,2);n(P,()=>de,(f,p)=>{p(f,{children:(b,se)=>{var v=i(),g=s(v);mt(g,17,()=>e(pe),ct,(k,_)=>{var B=i(),Se=s(B);{let C=Be(()=>yt(Dt(`/tasks/${encodeURIComponent(e(_).taskName)}`),"preset","from","to"));n(Se,()=>ue,(ne,le)=>{le(ne,{class:"cursor-pointer hover:bg-muted/50",get onclick(){return e(C)},children:(ie,Ne)=>{var x=Ut(),Oe=s(x);n(Oe,()=>M,(F,R)=>{R(F,{class:"font-mono text-sm",children:(z,ye)=>{Z();var u=Q();ee(()=>V(u,e(_).taskName)),a(z,u)},$$slots:{default:!0}})});var Ee=c(Oe,2);n(Ee,()=>M,(F,R)=>{R(F,{class:"tabular-nums",children:(z,ye)=>{Z();var u=Q();ee(J=>V(u,J),[()=>We(e(_).count)]),a(z,u)},$$slots:{default:!0}})});var Ae=c(Ee,2);n(Ae,()=>M,(F,R)=>{R(F,{class:"font-mono text-sm tabular-nums",children:(z,ye)=>{Z();var u=Q();ee(J=>V(u,J),[()=>Ge(e(_).p50Duration)]),a(z,u)},$$slots:{default:!0}})});var nt=c(Ae,2);n(nt,()=>M,(F,R)=>{R(F,{class:"font-mono text-sm tabular-nums",children:(z,ye)=>{Z();var u=Q();ee(J=>V(u,J),[()=>Ge(e(_).p95Duration)]),a(z,u)},$$slots:{default:!0}})}),a(ie,x)},$$slots:{default:!0}})})}a(k,B)}),a(b,v)},$$slots:{default:!0}})}),a(m,h)};De(A,m=>{e(pe).length===0?m(K):m(Y,!1)},!0)}a($,E)};De(Pe,$=>{e(ae)?$(be):$(xe,!1)},!0)}a(O,H)};De(at,O=>{e(re)?O(ot):O(st,!1)})}a(d,Ie)},$$slots:{default:!0}})}),X(Te);var rt=c(Te,2);bt(rt,{get currentPage(){return e(y)},get totalPages(){return e(ge)},get pageSize(){return e(ve)},get totalItems(){return e(we)},onPageChange:Xe,onPageSizeChange:Ze,get loading(){return e(re)},itemLabel:"task"}),X($e),a(Ye,$e),gt()}export{tr as component,er as universal};
